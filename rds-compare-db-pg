#!/bin/bash

set -euo pipefail

if [[ $# -ne 2 ]]; then
  echo "Usage: $0 <parameter-group-1> <parameter-group-2>"
  exit 1
fi

GROUP1="$1"
GROUP2="$2"

TMP_DIR=$(mktemp -d)
trap 'rm -rf "$TMP_DIR"' EXIT

aws rds describe-db-cluster-parameters \
  --db-cluster-parameter-group-name "$GROUP1" \
  --query "Parameters[].[ParameterName, ParameterValue]" \
  --output json > "$TMP_DIR/group1.json"

aws rds describe-db-cluster-parameters \
  --db-cluster-parameter-group-name "$GROUP2" \
  --query "Parameters[].[ParameterName, ParameterValue]" \
  --output json > "$TMP_DIR/group2.json"

jq -S '.' "$TMP_DIR/group1.json" > "$TMP_DIR/group1.sorted.json"
jq -S '.' "$TMP_DIR/group2.json" > "$TMP_DIR/group2.sorted.json"

diff -u "$TMP_DIR/group2.sorted.json" "$TMP_DIR/group1.sorted.json" || true

